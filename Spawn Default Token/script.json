{
  "name": "SpawnDefaultToken",
  "script": "SpawnDefaultToken.js",
  "version": "0.17",
  "description": "**Spawns one or more default tokens for a given character, with various options for placement and token characteristics.**\r\r**FORUM LINK:** For full documentation (including many examples), see the forum thread for this script [here](https://app.roll20.net/forum/post/9649899/script-spawn-default-token-thread-2/?pageforid=9649899#post-9649899) (NOTE: May open in this browser tab. You may want to create a duplicate tab before clicking link)\r\r**Instructions**\r*Case 1: Selected token is the basis for spawn origin*\rTo use, select one or more tokens on the map, and call the script with at minimum the name of the 'character' to summon. The following will simply spawn 1 of the default character tokens in the center of each selected token.\r`!Spawn --name|charName`\r*Case 2: Target token is the basis for spawn origin*\rInitial token selection is still required (as it is used for some defaults), but you can optionally cause the tokens to spawn at targeted token(s), with a little trickery. Roll20 has a standing bug that if both selected and target tokens are passed to an api script, the selected tokens are not retained. To get around this, after the initial call, the script will generate a chat button to prompt for a number of targets and will call itself again with the now complete set of information.\r`!Spawn --name|charName --targets|2`\r\r**Description of commands (only --name is required, the rest are optional):**\rSpawn supports multi-line commands using double bracket notation `{{ }}`. Note: I put< > around each of the parameters below for readability. **_Don't include < > for actual use._**\r`!Spawn {{`\r`--name|< charName >` //(REQUIRED) name of the character whose target we want to spawn\r`--targets|< # >` //Destination override. Instead of using selected token(s) as origin, use target token(s)\r`--qty|< # >` //DEFAULT = 1. How many tokens to spawn at each origin point. MAX = 20.\r&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Supports hardcoded and rollable table inline rolls such as [[ 1d6 ]] and [[ 1t[tableName] ]]\r`--offset|< #,# >` //DEFAULT = 0,0. The X,Y pos or neg shift in position of the spawn origin point(s) relative to the origin token(s), in number of SQUARES.\r&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(NOTE: a POSITIVE Y offset means LOWER on the map)\r`--placement|< option >` //How to arrange the tokens relative to the origin point (+ offset). Options are:\r&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//**'stack'**: (DEFAULT) All tokens will be stacked on top of each other\r&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//**'row'**: A horizontal row of tokens\r&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//**'column,col'**: A vertical column of tokens\r&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//**'surround'**: A clockwise spiral placement around origin token, starting at top  (NOTE: any supplied offset will be ignored)\r&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//**'grid #'**: A square grid with '#' tokens per row. Raster left to right\r&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//**'burst #'**: An expanding diagonal distribution of tokens starting '#' squares from the 4 origin token corners. Large qty will form an 'X' pattern\r&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//**'cross #'**= 'evenly' distributed vert/horiz cross pattern, starting directly above origin by # squares. Large qty will form a '+' pattern\r`--size|< #,# >` //DEFAULT = 1,1 (X,Y). How many SQUARES wide and tall are the spawned tokens?\r`--side|< # or rand>` //DEFAULT = 1. Sets the side of a rollable table token.\r&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//**#**: Sets the side of all spawned tokens to '#'\r&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//**'rand,random'**: Each spawned token will be set to a random side\r`--order|< option >` //The z-order of the token. (NOTE: a recent Roll20 'feature' will always put character tokens with sight above those without, so YMMV.) Valid options are:\r&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//**toFront,front,top,above**: Spawn token moved to front\r&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//**toBack,back,bottom,below**: Spawn token moved to back\r`--light|< #,# >` //Set light radius that all players can see.\r&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//**For Legacy Dynamic Lighting (LDL):**\r&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//First # is the total radius of the light (light\\_radius)\r&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Second # is the start of dim light (light\\_dimradius) (so: 10,5 will be 10 ft of total light, with dim radius starting at 5ft)\r&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//**For Updated Dynamic Lighting (UDL):**\r&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//First # is the radius of bright light (bright\\_light\\_distance)\r&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Second # is the additional radius of dim light (so: 10,5 will be 10ft of bright light + 5ft of dim light)\r`--mook|< yes/true/1/no/false/0 >` //DEFAULT = false (any linked bar values are retained)\r //If set to true, bar links are removed\r`--force|< yes/true/1/no/false/0 >` //DEFAULT = false. The origin point is by default relative to the geometric center of the origin token\r&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Origin tokens of larger than 1x1 may spawn tokens in between squares, which may be strange depending on the specific case\r&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Set to true in order to force the token to spawn in a full square\r`--sheet|< charName2 >` //DEFAULT = selected character. The character sheet in which to look for the supplied ability\r&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//useful if the ability exists on a 'macro mule', etc.\r`--ability|< abilityName >` //The ability to trigger after spawning occurs. With caveats as described in the forum thread\r`--fx|< type-color >` //Trigger FX at each origin point.\r&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Supported types are: **bomb,bubbling,burn,burst,explode,glow,missile,nova,splatter**\r&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Supported colors are: **acid,blood,charm,death,fire,frost,holy,magic,slime,smoke,water**\r`--bar1|< currentVal/optionalMax  optional 'KeepLink'>` //overrides the token's bar1 current and max values. Max is optional. If overridden, bar1\\_link will be removed. If 'KeepLink' is appended, the bar1\\_link will be preserved \r`--bar2|< currentVal/optionalMax optional 'KeepLink'>` //overrides the token's bar2 current and max values. Max is optional. If overridden, bar2\\_link will be removed. If 'KeepLink' is appended, the bar1\\_link will be preserved \r`--bar3|< currentVal/optionalMax optional 'KeepLink'>` //overrides the token's bar3 current and max values. Max is optional. If overridden, bar3\\_link will be removed. If 'KeepLink' is appended, the bar1\\_link will be preserved \r`--expand|< #frames, delay, optional yes/true/1 >` //Animates the token during spawn. Expands from size = 0 to max size.\r&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//**#frames:** how many frames the expansion animation will use. Start with something like 20\r&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//**delay:** how many milliseconds between triggering each frame? Start with something like 50. Any less than 30 may appear instant\r&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//**Optional yes/true/1/**:Setting the third parameter to true will delete the spawned token after animation\r`--deleteSource|  < yes/true/1/no/false/0 >` //DEFAULT = false. Deletes the selected token(s) upon spawn\r`--deleteTarget|  < yes/true/1/no/false/0 >` //DEFAULT = false. Deletes the target token(s) upon spawn\r`--resizeSource|  < #,# <optional #frames, #delay> >` //DEFAULT = n/a. Animates the selected token(s) during spawn.\r&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//**#,#**: the new size of the selected token(s). If any dimension is set to 0, it will delete the token after animation\r&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//**#frames**: DEFAULT = 20. how many frames the animation will use.\r&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//**delay**: DEFAULT = 50. how many milliseconds between triggering each frame? Anything less than 30 may appear instant\r`--resizeTarget|  < #,# <optional #frames, #delay> >` //DEFAULT = n/a. Animates the target token(s) during spawn.\r&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//**#,#**: the new size of the target token(s). If any dimension is set to 0, it will delete the token after animation\r&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//**#frames**: DEFAULT = 20. how many frames the animation will use.\r&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//**delay**: DEFAULT = 50. how many milliseconds between triggering each frame? Anything less than 30 may appear instant\r`--rotation|  < #/random/rand >` //sets the rotational angle of the spawned token during runtime.\r&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//**#**: the angle (in degrees) of the spawned token&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//**'Rand' or 'random'**: The token will spawn at a random angle\r`}}`\r\r**_Advanced Examples_**\r**1.** Spawn 4 dancing lights globes in a burst radius 2 centered on the selected token. Uses a rollable table token called GenericSpellAOE, sets the size of each to a single 1x1 square, sets side to '7', emits LDL dim light in 10ft radius, and performs a ToFront operation on the globes\r**!Spawn {{\r&nbsp;&nbsp;&nbsp;--name| GenericSpellAoE\r&nbsp;&nbsp;&nbsp;--qty| 4\r&nbsp;&nbsp;&nbsp;--placement| burst 2\r&nbsp;&nbsp;&nbsp;--offset| 0,0\r&nbsp;&nbsp;&nbsp;--size| 1,1\r&nbsp;&nbsp;&nbsp;--side| 7\r&nbsp;&nbsp;&nbsp;--order | toFront\r&nbsp;&nbsp;&nbsp;--light| 10,-5\r}}**\r\r**2.** The next example casts a Flaming Sphere adjacent to a _target_, rather than the selected token, using our GenericSpellAoE rollable table token again. A button will be output to chat to trigger the target selection. We are also triggering an ability named FlamingSphereDam that was made on the GenericSpellAoE character sheet ahead of time (the --sheet command tells where to look for the ability, and overrides the default search location of the selected character). The ability automatically rolls the damage for the spell, using a 5E template.\r**!Spawn {{\r&nbsp;&nbsp;&nbsp;--name| GenericSpellAoE\r&nbsp;&nbsp;&nbsp;--targets| 1\r&nbsp;&nbsp;&nbsp;--offset| 1,0\r&nbsp;&nbsp;&nbsp;--size| 1,1\r&nbsp;&nbsp;&nbsp;--side| 2\r&nbsp;&nbsp;&nbsp;--order | toFront\r&nbsp;&nbsp;&nbsp;--light| 40,20\r&nbsp;&nbsp;&nbsp;--sheet| GenericSpellAoE\r&nbsp;&nbsp;&nbsp;--ability| FlamingSphereDam\r}}**\r\r_For more examples, visit the forum link above_",
  "authors": "David M.",
  "roll20userid": 3987469,
  "patreon": "",
  "useroptions": [],
  "dependencies": [],
  "modifies": {       
    "character.*": "read",
    "graphic.*": "read, write",
    "ability.*": "read",
    "player.displayname": "read"
  },
  "conflicts": [],
  "previousversions": [
     "0.0",
     "0.1",
     "0.2",
     "0.3",
     "0.4",
     "0.5",
     "0.6",
     "0.7",
     "0.8",
     "0.9",
     "0.10",
     "0.11",
     "0.12",
     "0.13",
     "0.14",
     "0.15",
     "0.17"
  ]
}
